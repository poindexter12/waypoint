# Waypoint Test Makefile
# Dedicated Makefile for running tests
# Usage: make -f Makefile.test [target]

# Colors for output
BLUE := \033[0;34m
GREEN := \033[0;32m
YELLOW := \033[0;33m
RED := \033[0;31m
NC := \033[0m

# Test configuration
VENV_DIR := .venv
PYTHON := $(VENV_DIR)/bin/python3
TEST_SCRIPT := tests/test_waypoint.py

.PHONY: help
help:
	@echo "$(BLUE)Waypoint Test Suite$(NC)"
	@echo ""
	@echo "$(GREEN)Usage:$(NC)"
	@echo "  make -f Makefile.test [target]"
	@echo ""
	@echo "$(GREEN)Targets:$(NC)"
	@echo "  help        Show this help message (default)"
	@echo "  test        Run the full test suite"
	@echo "  setup       Set up test environment with uv"
	@echo "  clean       Clean up test environment and artifacts"
	@echo ""
	@echo "$(GREEN)Examples:$(NC)"
	@echo "  make -f Makefile.test test         Run all tests"
	@echo "  make -f Makefile.test setup        Set up test environment"
	@echo "  make -f Makefile.test clean        Clean up test files"

.PHONY: setup
setup:
	@echo "$(BLUE)Setting up test environment...$(NC)"
	@if ! command -v uv &> /dev/null; then \
		echo "$(YELLOW)⚠ uv not found. Installing uv...$(NC)"; \
		curl -LsSf https://astral.sh/uv/install.sh | sh; \
	fi
	@if [ ! -d "$(VENV_DIR)" ]; then \
		echo "$(BLUE)Creating virtual environment with uv...$(NC)"; \
		uv venv $(VENV_DIR); \
		echo "$(GREEN)✓ Virtual environment created$(NC)"; \
	else \
		echo "$(GREEN)✓ Virtual environment already exists$(NC)"; \
	fi

.PHONY: test
test: setup
	@echo "$(BLUE)Running test suite...$(NC)"
	@$(PYTHON) $(TEST_SCRIPT)

.PHONY: clean
clean:
	@echo "$(BLUE)Cleaning test environment...$(NC)"
	@rm -rf $(VENV_DIR)
	@rm -rf tests/__pycache__
	@rm -rf .pytest_cache
	@find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null || true
	@find . -name "*.pyc" -delete 2>/dev/null || true
	@echo "$(GREEN)✓ Test environment cleaned$(NC)"
